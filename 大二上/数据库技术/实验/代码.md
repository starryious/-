```sql
/*创建表"书" */
CREATE TABLE book
( bno char(8) primary key,
  category char(10) NOT NULL,
  title varchar(40) NOT NULL,
  press varchar(30) NOT NULL,
  year int NOT NULL,
   author varchar(20) NOT NULL,
   price decimal(7,2) NOT NULL,
   total int NOT NULL,
   stock int NOT NULL
);
/* 创建索引 */
CREATE INDEX book_bno ON book (bno);
CREATE INDEX book_title ON book (title);
/* 插入数据 */
 INSERT INTO book(bno, category, title,press,year,author,price,total,stock) VALUES
('1','小说','解忧杂货店','南海出版公司',2014,'东野圭吾',28.00,6,5),
('2','生物学','物种起源','哈佛大学',2002,'达尔文',32.00,7,6),
('3','童话','小王子','人民文学出版社',2003,'托万德胜埃克苏佩里',34.00,8,7),
('4','悬疑','白夜行','南海出版公司',2008,'东野圭吾',36.00,9,8),
('5','社科','围城','人民文学出版社',1991,'钱钟书',58.00,5,4),
('6','小说','挪威的森林','重庆出版社',2008,'村上春树',60.00,4,3),
('7','悬疑','嫌疑人x的献身','上海译文出版社',2001,'东野圭吾',56.00,6,4),
('8','小说','活着','南海出版公司',2000,'余华',54.00,7,5),
('9','小说','红楼梦','南海出版公司',1998,'曹雪芹',64.00,4,3),
('10','小说','百年孤独','人民文学出版社',1996,'加西亚马尔克斯',70.00,5,2),
('11','小说','不能承受的生命之轻','南海出版公司',2011,'米兰昆德拉',28.00,12,1),
('12','小说','达· 芬奇密码','上海译文出版社',2003,'丹布朗',27.00,7,4),
('13','教育','造就出类拔萃的孩子','育年出版社',1998,'佚名1',31.00,3,2),
('14','教育','让青春更阳光','吉林人民出版社',2001,'佚名2',33.00,2,2),
('15','教育','影响几代人的成长法则','光明日报出版社',1997,'佚名3',35.00,3,2),
('16','教育','树立信心的哲理感悟','吉林人民出版社',1996,'佚名4',36.00,4,2),
('17','教育','班主任实用“百宝箱”','北师大出版社',2014,'佚名5',36.00,3,2),
('18','教育','教师工作方法创新案例集','北师大出版社',2014,'佚名6',37.00,2,1),
('19','教育','优秀校长必须做好的事','北师火出版社',2014,'佚名7',38.00,3,2),
('20','教育','打造精彩课堂有妙招','东北师范出版社','2014','佚名8',50.00,4,3),
('21','教育','中学生心理健康教育','江西高校出版社',2014,'佚名9',38.00,3,2),
('22','教育','班主任如何批评学生','北师大出版社',2014,'佚名10',39.00,2,1),
('23','教育','教师用书成人之荧','北师大出版社',2014,'佚名11',46.00,3,2),
('24','教育','教师教育学','北师大出版社',2014,'佚名12',43.00,4,3),
('25','教育','教你五步做成功教师','北师大出版社',2014,'佚名13',42.00,3,2),
('26','教育','评课和智葱与技巧','北师大出版社',2013,'佚名14',41.00,2,1),
('27','教育','学生的心结要你解','北师大出版社',2013,'佚名15',38.00,3,2),
('28','教育','教你成为专家型教师','北师大出版社',2010,'佚名16',37.00,4,3),
('29','教育','等你在北大','吉林人民出版社',2013,'佚名17',34.00,3,2),
('30','教育','等你在清华上中下','吉林人民出版社',2021,'佚名18',35.00,14,1),
('31','教育','等你在复旦大学','文化出版社',2021,'佚名19',32.00,3,2),
('32','教育','等你在南开大学','文化出版社','2009','佚名20',32.00,24,3),
('33','教育','读中外名岩悟智惹人生','文化出版社',2021,'佚名21',31.00,3,2),
('34','教育','美文名篇双语阅读最绐丽的英文','文化出版社',2021,'佚名22',30.00,5,4),
('35','教育','震撼学生的随笔','文化出版社',2021,'佚名23',42.00,19,3),
('36','教育','读经商之道悟财高人生','文化出版社',2021,'佚名24',43.00,6,5),
('37','教育','水浒一百单八将外传','光明日报出版社',2000,'佚名25',42.00,4,3),
('38','教育','做成功教师的切入口','北师大出版社',2000,'佚名26',41.00,5,4),
('39','教育','教师心理健康调适技巧','北师大出版社',2000,'佚名27',40.00,3,2),
('40','教育','教师如何驾驶教育技术','北师大出版社',2000,'佚名28',55.00,3,2),
('41','教育','难点及其对策','北师大出版社',2000,'佚名30',57.00,4,3),
('42','教育','小故弟大启示','吉林人民出版社',2000,'佚名31',58.00,2,1),
('43','教育','中学英语常用词语辨析','南海出版社',2000,'佚名32',45.00,4,3),
('44','教育','高考状元经验谈','吉林人民出版社',2016,'佚名33',36.00,3,2),
('45','教育','别让坏恃绪吝了你','光明日报',2016,'佚名34',52.00,4,3),
('46','教育','心灵小木屋系列-一盏心灯','光明日报',2016,'佚名35',53.00,5,4),
('47','教育','窈凫教育规划','光明日报',2016,'佚名36',38.00,6,5),
('48','教育','教师的格言','术摄影出版社',2016,'佚名37',37.00,7,6),
('49','教育','语文教学审典教育','教育出版社',2016,'佚名38',42.00,8,5),
('50','教育','数据库系统原理教程','清华大学出版社',1998,'王珊',43.00,7,5),
('51','教育','语言学教程','教育出版社',1997,'佚名39',46.00,6,5),
('52','教育','做事先做人','西苑出版社',1998,'佚名40',47.00,7,5),
('53','史诗','尼伯龙根之歌','人民文学出版社','2002','佚名41',40.00,4,3),
('54','史诗','伊利亚特','人民文学出版社','2002','荷马',40.00,4,3),
('55','史诗','奥德赛','北京出版社','2002','荷马',40.00,4,3),
('56','剧本','美狄亚','清华出版社','2002','欧里庇得斯',40.00,4,3),
('57','剧本','哈姆雷特','北大出版社','2002','莎士比亚',40.00,4,3),
('58','史诗','希波利图斯','复旦出版社','2002','欧里庇得斯',40.00,4,3),
('59','史诗','酒神的女祭司们','上海出版社','2002','尤瑞皮底斯',40.00,4,3),
('60','史诗','伯罗奔尼撒战争史','译林出版社','2002','修昔底德',40.00,4,3),
('61','史诗','希腊罗马名人传','文学出版社','2002','普鲁塔克',40.00,44,3),
('62','史诗','罗马史','陕西出版社','2002','特奥多尔·蒙森',40.00,4,3),
('63','史诗','变形记','科学出版社','2002','奥维德',40.00,4,3),
('64','史诗','几何原理','数学出版社','2002','欧几里得',40.00,4,3),
('65','史诗','尼各马可伦理学','社会出版社','2002','亚里士多德',40.00,4,3),
('66','小说','了不起的盖茨比','斯克里布纳',1925,'弗·斯科特·菲茨杰拉德',12.99,100,50),
('67','小说','红与黑','双语出版社',1830,'普鲁斯特',14.99,150,60),
('68','小说','傲慢与偏见','双语出版社',1813,'达·芬奇',13.99,120,50),
('69','小说','安娜·卡列尼娜','双语出版社',1878,'柴可夫斯基',15.99,130,55),
('70','小说','呼啸山庄','双语出版社',1847,'勃朗特',16.99,140,60),
('71','小说','儒林外史','双语出版社',1792,'吴敬梓',17.99,110,45),
('72','小说','海底两万里','双语出版社',1870,'儒勒·凡尔纳',18.99,100,40),
('73','小说','悲惨世界','双语出版社',1885,'雨果',19.99,90,35),
('74','小说','百年孤独','双语出版社',1967,'加西亚·马尔克斯',20.99,120,50),
('75','小说','巴黎圣母院','双语出版社',1831,'雨果',21.99,130,55),
('76','小说','查泰莱夫人的情人','双语出版社',1878,'爱尔兰·墨菲',22.99,140,60),
('77','小说','骆驼祥子','双语出版社',1928,'巴金',23.99,150,65),
('78','小说','洛丽塔','双语出版社',1839,'拿破仑·雨果',24.99,160,70),
('79','小说','双城记','双语出版社',1859,'查尔斯·狄更斯',25.99,170,75),
('80','小说','普通心理学','双语出版社',1890,'西格蒙·德·拉斐尔',26.99,180,80),
('81','小说','欧也尼','双语出版社',1925,'伊索·费尔巴哈',27.99,190,85),
('82','小说','小王子','双语出版社',1943,'圣埃克苏佩里',28.99,200,90),
('83','小说','钢铁是怎样炼成的','双语出版社',1925,'尼古拉·奥斯特洛夫斯基',29.99,210,95),
('84','小说','现代汉语词典','双语出版社',1955,'汉语词典',50.00,100,80),
('85','小说','双城记','双语出版社',1859,'查尔斯·狄更斯',25.99,170,75),
('86','小说','普通心理学','双语出版社',1890,'西格蒙·德·拉斐尔',26.99,180,80),
('87','小说','欧也尼','双语出版社',1925,'伊索·费尔巴哈',27.99,190,85),
('88','小说','小王子','双语出版社',1943,'圣埃克苏佩里',28.99,200,90),
('89','小说','钢铁是怎样炼成的','双语出版社',1925,'尼古拉·奥斯特洛夫斯基',29.99,210,95),
('90','小说','现代汉语词典','双语出版社',1955,'汉语词典',30.99,220,100),('85','小说','汉语大词典','文化出版社',1953,'汉语词典',29.99,200,80)
('91','小说','中华新汉语词典','华语出版社',1956,'汉语词典',31.99,215,85),
('92','小说','语文大词典','中文出版社',1958,'汉语词典',32.99,225,92),
('93','小说','新世纪汉语词典','新世纪出版社',1960,'汉语词典',33.99,235,98),
('94','小说','现代汉语词汇','现代出版社',1962,'汉语词典',34.99,242,103),
('95','小说','中文字典','中文出版集团',1964,'汉语词典',35.99,250,108),
('96','小说','词语辞典','语文出版社',1966,'汉语词典',36.99,257,113),
('97','小说','汉语大词汇','文学出版社',1968,'汉语词典',37.99,265,118),
('98','小说','新华汉语词典','新华出版社',1970,'汉语词典',38.99,272,123),
('99','小说','汉语词汇手册','手册出版社',1972,'汉语词典',39.99,280,128);
```

```sql
/* 创建表"借书证" */
CREATE TABLE card
(`cno` char(7) primary key,
`name` varchar(10)   NOT NULL,
`department` varchar(40)  NOT NULL ,
`type` char(1)  NOT NULL
 CHECK (type IN ('T','G','U','O'))
 );
  /*创建索引*/
CREATE INDEX card_cno ON card (cno);
CREATE INDEX card_name ON card (name);
/*插入数据*/
 INSERT INTO card(cno,name,department,type) VALUES
 (1,'Kamden','Math','U'),
 (2,'Mike','Math','U'),
 (3,'Amy','CS','G'),
 (4,'Joe','CS','O'),
 ('5','John','CS','T'),
 ('6','Kavin','History','U'),
 ('7','Luna','History','U'),
 ('8','Kay','History','U'),
 ('9','Michael','Math','U'),
 ('10','Dick','Geography','G'),
 ('11','Julia','Art','U'),
 
```

```sql
/* 创建表"借书记录" */
 CREATE TABLE borrow
(cno char(7) NOT NULL,
 bno char(8),
 borrow_date date,
 return_date date,
 foreign key (bno)
 references book(bno) on update cascade on delete cascade
 );
 /*创建索引*/
CREATE INDEX borrow_cno ON borrow (cno);
CREATE INDEX borrow_bno ON borrow (bno);
/*插入数据*/
INSERT INTO borrow(cno,bno,borrow_date,return_date) VALUES
(1,'1','2022-01-01','2022-01-13'),
(1,'2','2022-01-02','2022-01-16'),
(3,'3','2022-01-03','2022-01-12'),
(4,'4','2022-01-04','2022-01-14'),
(5,'5','2022-01-05','2022-01-15'),
(5,'8','2022-01-05','2022-01-15'),
(6,'10','2022-11-22','2022-12-15'),
(8,'28','2022-10-05','2022-11-15'),
(11,'29','2022-11-05','2022-12-15'),
(5,'1','2022-02-10','2022-03-10'),
(4,'20','2022-03-10','2022-04-10');
```

```mysql
/*触发器*/
CREATE TRIGGER check_book_stock
BEFORE INSERT ON borrow
FOR EACH ROW
BEGIN
    DECLARE book_stock INT DEFAULT 0;

    SELECT stock INTO book_stock
    FROM book
    WHERE bno = NEW.bno;

    IF book_stock = 0 THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Book stock is 0, borrow operation failed.';
    ELSE
        UPDATE book
        SET stock = stock - 1
        WHERE bno = NEW.bno;
    END IF;
END //
```

